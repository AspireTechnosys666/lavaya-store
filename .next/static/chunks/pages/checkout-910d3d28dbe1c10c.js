(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[222],{5248:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout",function(){return s(7116)}])},7116:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return D}});var l=s(7168),o=s(608),a=s(880),n=s(8381),r=s(30),i=s.n(r),d=s(3835),c=s(7136),m=s.n(c),u=s(4423),p=s(7644),x=s(4382),h=s(2769),f=s(2913),v=s(7098),g=s(1424),y=s(6239),j=s(1305),N=s(6286),b=s(7957),form_InputShipping=e=>{let{register:t,value:s,time:o,cost:a,currency:n,handleShippingCost:r}=e;return(0,l.jsx)("div",{children:(0,l.jsx)("div",{className:"p-3 card border border-gray-200 bg-white rounded-md",children:(0,l.jsx)("label",{className:"cursor-pointer label",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"text-2xl mr-3 text-gray-400",children:(0,l.jsx)(b.C4B,{})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h6",{className:"font-serif font-medium text-sm text-gray-600",children:s}),(0,l.jsxs)("p",{className:"text-xs text-gray-500 font-medium",children:["Delivery: ",o," ",(0,l.jsxs)("span",{className:"font-medium text-gray-600",children:["Cost :",n,a,".00"]})]})]})]}),(0,l.jsx)("input",{onClick:()=>r(a),...t("shippingOption",{required:"Shipping Option is required!"}),name:"shippingOption",type:"radio",value:s,className:"form-radio outline-none focus:ring-0 text-emerald-500"})]})})})})},form_InputPayment=e=>{let{register:t,Icon:s,name:o,value:a,setShowCard:n}=e;return(0,l.jsx)("div",{className:"px-3 py-4 card border border-gray-200 bg-white rounded-md",children:(0,l.jsx)("label",{className:"cursor-pointer label",children:(0,l.jsxs)("div",{className:"flex item-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"text-xl mr-3 text-gray-400",children:(0,l.jsx)(s,{})}),(0,l.jsx)("h6",{className:"font-serif font-medium text-sm text-gray-600",children:o})]}),(0,l.jsx)("input",{onClick:()=>n("Card"===a),...t("paymentMethod",{required:"Payment Method is required!"}),type:"radio",value:a,name:"paymentMethod",className:"form-radio outline-none focus:ring-0 text-emerald-500"})]})})})},C=s(5166),_=s(6635),w=s.n(_),Z=s(655),k=s(6250),S=s(7909),I=s(9210),O=s(4302),P=s(4671),E=s(3463),A=s(6554),F=s(3049),M={addNotification:async(e,t)=>F.Z.post("/notification/add",e,t)},hooks_useCheckoutSubmit=()=>{let{state:{userInfo:e,shippingAddress:t},dispatch:s}=(0,n.useContext)(I.S),[l,o]=(0,n.useState)(""),[a,r]=(0,n.useState)(""),[i,c]=(0,n.useState)({}),[m,u]=(0,n.useState)(0),[p,x]=(0,n.useState)(!1),[h,v]=(0,n.useState)(0),[g,y]=(0,n.useState)(0),[j,N]=(0,n.useState)(0),[b,_]=(0,n.useState)(!1),[F,B]=(0,n.useState)(!1),T=(0,Z.useRouter)(),D=(0,d.useStripe)(),z=(0,d.useElements)(),q=(0,n.useRef)(""),{isEmpty:L,emptyCart:H,items:J,cartTotal:R}=(0,S.jD)(),{register:U,handleSubmit:Y,setValue:V,formState:{errors:G}}=(0,k.cI)(),{data:W}=(0,f.Z)(P.Z.getAllCoupons),{data:X}=(0,f.Z)(A.Z.getGlobalSetting),K=(null==X?void 0:X.default_currency)||"$";(0,n.useEffect)(()=>{if(C.Z.get("couponInfo")){let e=JSON.parse(C.Z.get("couponInfo"));c(e),N(e.discountType),u(e.minimumAmount)}},[F]),(0,n.useEffect)(()=>{(m-g>a||L)&&(N(0),C.Z.remove("couponInfo"))},[m,a]),(0,n.useEffect)(()=>{let e=null==J?void 0:J.reduce((e,t)=>e+t.itemTotal,0),t="",s=parseFloat(R+Number(h)).toFixed(2),l=(null==j?void 0:j.type)==="fixed"?null==j?void 0:j.value:e*((null==j?void 0:j.value)/100),o=l||0;t=Number(s)-o,y(o),r(t)},[R,h,j]),(0,n.useEffect)(()=>{e||T.push("/"),V("firstName",t.firstName),V("lastName",t.lastName),V("address",t.address),V("contact",t.contact),V("email",t.email),V("city",t.city),V("country",t.country),V("zipCode",t.zipCode)},[]);let submitHandler=async e=>{try{s({type:"SAVE_SHIPPING_ADDRESS",payload:e}),C.Z.set("shippingAddress",JSON.stringify(e)),_(!0),o("");let t={name:"".concat(e.firstName," ").concat(e.lastName),contact:e.contact,email:e.email,address:e.address,country:e.country,city:e.city,zipCode:e.zipCode},l={user_info:t,shippingOption:e.shippingOption,paymentMethod:e.paymentMethod,status:"Pending",cart:J,subTotal:R,shippingCost:h,discount:g,total:a};if("Card"===e.paymentMethod){if(!D||!z)return;let{error:e,paymentMethod:t}=await D.createPaymentMethod({type:"card",card:z.getElement(d.CardElement)});if(e&&!t)o(e.message),_(!1);else{o("");let e={...l,cardInfo:t};handlePaymentWithStripe(e);return}}if("Cash"===e.paymentMethod){let e=await O.Z.addOrder(l),t={orderId:e._id,message:"".concat(e.user_info.name,", Placed ").concat(K).concat(parseFloat(e.total).toFixed(2)," order!"),image:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png"};await M.addNotification(t),T.push("/order/".concat(e._id)),(0,E.t5)("Your Order Confirmed!"),C.Z.remove("couponInfo"),sessionStorage.removeItem("products"),H(),_(!1)}}catch(e){(0,E.cB)(e.message),_(!1)}},handlePaymentWithStripe=async e=>{try{let t=await O.Z.createPaymentIntent(e);D.confirmCardPayment(t.client_secret,{payment_method:{card:z.getElement(d.CardElement)}});let s={...e,cardInfo:t},l=await O.Z.addOrder(s),o={orderId:l._id,message:"".concat(l.user_info.name,", Placed ").concat(K).concat(parseFloat(l.total).toFixed(2)," order!"),image:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png"};await M.addNotification(o),T.push("/order/".concat(l._id)),(0,E.t5)("Your Order Confirmed!"),C.Z.remove("couponInfo"),H(),sessionStorage.removeItem("products"),_(!1)}catch(e){var t,s;(0,E.cB)((null==e?void 0:null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||(null==e?void 0:e.message)),_(!1)}};return{handleSubmit:Y,submitHandler,handleShippingCost:e=>{v(e)},register:U,errors:G,showCard:p,setShowCard:x,error:l,stripe:D,couponInfo:i,couponRef:q,handleCouponCode:e=>{var t,l,o;if(e.preventDefault(),!q.current.value){(0,E.cB)("Please Input a Coupon Code!");return}let n=W.filter(e=>e.couponCode===q.current.value);if(n.length<1){(0,E.cB)("Please Input a Valid Coupon!");return}if(w()().isAfter(w()(null===(t=n[0])||void 0===t?void 0:t.endTime))){(0,E.cB)("This coupon is not valid!");return}if(a<(null===(l=n[0])||void 0===l?void 0:l.minimumAmount)){(0,E.cB)("Minimum ".concat(n[0].minimumAmount," USD required for Apply this coupon!"));return}(0,E.t5)("Your Coupon ".concat(n[0].couponCode," is Applied on ").concat(n[0].productType,"!")),B(!0),u(null===(o=n[0])||void 0===o?void 0:o.minimumAmount),N(n[0].discountType),s({type:"SAVE_COUPON",payload:n[0]}),C.Z.set("couponInfo",JSON.stringify(n[0]))},discountPercentage:j,discountAmount:g,shippingCost:h,total:a,isEmpty:L,items:J,cartTotal:R,currency:K,isCheckoutSubmit:b,isCouponApplied:F}},B=s(2182);let Checkout=()=>{var e,t,s,o,a,n,r,i,c,b,C,_,w,Z,k,S,I,O,P,E;let{handleSubmit:F,submitHandler:M,handleShippingCost:T,register:D,errors:z,showCard:q,setShowCard:L,error:H,stripe:J,couponInfo:R,couponRef:U,handleCouponCode:Y,discountAmount:V,shippingCost:G,total:W,isEmpty:X,items:K,cartTotal:$,currency:Q,isCheckoutSubmit:ee}=hooks_useCheckoutSubmit(),{t:et}=(0,x.Z)(),{storeCustomizationSetting:es}=(0,N.Z)(),{showingTranslateValue:el}=(0,B.Z)(),{data:eo}=(0,f.Z)(A.Z.getStoreSetting);return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(h.Z,{title:"Checkout",description:"this is checkout page",children:(0,l.jsx)("div",{className:"mx-auto max-w-screen-2xl px-3 sm:px-10",children:(0,l.jsxs)("div",{className:"py-10 lg:py-12 px-0 2xl:max-w-screen-2xl w-full xl:max-w-screen-xl flex flex-col md:flex-row lg:flex-row",children:[(0,l.jsx)("div",{className:"md:w-full lg:w-3/5 flex h-full flex-col order-2 sm:order-1 lg:order-1",children:(0,l.jsx)("div",{className:"mt-5 md:mt-0 md:col-span-2",children:(0,l.jsxs)("form",{onSubmit:F(M),children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsxs)("h2",{className:"font-semibold font-serif text-base text-gray-700 pb-3",children:["01."," ",el(null==es?void 0:null===(e=es.checkout)||void 0===e?void 0:e.personal_details)]}),(0,l.jsxs)("div",{className:"grid grid-cols-6 gap-6",children:[(0,l.jsxs)("div",{className:"col-span-6 sm:col-span-3",children:[(0,l.jsx)(j.Z,{register:D,label:el(null==es?void 0:null===(t=es.checkout)||void 0===t?void 0:t.first_name),name:"firstName",type:"text",placeholder:"John"}),(0,l.jsx)(g.Z,{errorName:z.firstName})]}),(0,l.jsxs)("div",{className:"col-span-6 sm:col-span-3",children:[(0,l.jsx)(j.Z,{register:D,label:el(null==es?void 0:null===(s=es.checkout)||void 0===s?void 0:s.last_name),name:"lastName",type:"text",placeholder:"Doe"}),(0,l.jsx)(g.Z,{errorName:z.lastName})]}),(0,l.jsxs)("div",{className:"col-span-6 sm:col-span-3",children:[(0,l.jsx)(j.Z,{register:D,label:el(null==es?void 0:null===(o=es.checkout)||void 0===o?void 0:o.email_address),name:"email",type:"email",placeholder:"youremail@gmail.com"}),(0,l.jsx)(g.Z,{errorName:z.email})]}),(0,l.jsxs)("div",{className:"col-span-6 sm:col-span-3",children:[(0,l.jsx)(j.Z,{register:D,label:el(null==es?void 0:null===(a=es.checkout)||void 0===a?void 0:a.checkout_phone),name:"contact",type:"tel",placeholder:"+062-6532956"}),(0,l.jsx)(g.Z,{errorName:z.contact})]})]})]}),(0,l.jsxs)("div",{className:"form-group mt-12",children:[(0,l.jsxs)("h2",{className:"font-semibold font-serif text-base text-gray-700 pb-3",children:["02."," ",el(null==es?void 0:null===(n=es.checkout)||void 0===n?void 0:n.shipping_details)]}),(0,l.jsxs)("div",{className:"grid grid-cols-6 gap-6 mb-8",children:[(0,l.jsxs)("div",{className:"col-span-6",children:[(0,l.jsx)(j.Z,{register:D,label:el(null==es?void 0:null===(r=es.checkout)||void 0===r?void 0:r.street_address),name:"address",type:"text",placeholder:"123 Boulevard Rd, Beverley Hills"}),(0,l.jsx)(g.Z,{errorName:z.address})]}),(0,l.jsxs)("div",{className:"col-span-6 sm:col-span-6 lg:col-span-2",children:[(0,l.jsx)(j.Z,{register:D,label:el(null==es?void 0:null===(i=es.checkout)||void 0===i?void 0:i.city),name:"city",type:"text",placeholder:"Los Angeles"}),(0,l.jsx)(g.Z,{errorName:z.city})]}),(0,l.jsxs)("div",{className:"col-span-6 sm:col-span-3 lg:col-span-2",children:[(0,l.jsx)(j.Z,{register:D,label:el(null==es?void 0:null===(c=es.checkout)||void 0===c?void 0:c.country),name:"country",type:"text",placeholder:"United States"}),(0,l.jsx)(g.Z,{errorName:z.country})]}),(0,l.jsxs)("div",{className:"col-span-6 sm:col-span-3 lg:col-span-2",children:[(0,l.jsx)(j.Z,{register:D,label:el(null==es?void 0:null===(b=es.checkout)||void 0===b?void 0:b.zip_code),name:"zipCode",type:"text",placeholder:"2345"}),(0,l.jsx)(g.Z,{errorName:z.zipCode})]})]}),(0,l.jsx)(v.Z,{label:el(null==es?void 0:null===(C=es.checkout)||void 0===C?void 0:C.shipping_cost)}),(0,l.jsxs)("div",{className:"grid grid-cols-6 gap-6",children:[(0,l.jsxs)("div",{className:"col-span-6 sm:col-span-3",children:[(0,l.jsx)(form_InputShipping,{currency:Q,handleShippingCost:T,register:D,value:"FedEx",time:"Today",cost:60}),(0,l.jsx)(g.Z,{errorName:z.shippingOption})]}),(0,l.jsxs)("div",{className:"col-span-6 sm:col-span-3",children:[(0,l.jsx)(form_InputShipping,{currency:Q,handleShippingCost:T,register:D,value:"UPS",time:"7 Days",cost:20}),(0,l.jsx)(g.Z,{errorName:z.shippingOption})]})]})]}),(0,l.jsxs)("div",{className:"form-group mt-12",children:[(0,l.jsxs)("h2",{className:"font-semibold font-serif text-base text-gray-700 pb-3",children:["03."," ",el(null==es?void 0:null===(_=es.checkout)||void 0===_?void 0:_.payment_method)]}),q&&(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)(d.CardElement,{})," ",(0,l.jsx)("p",{className:"text-red-400 text-sm mt-1",children:H})]}),(0,l.jsxs)("div",{className:"grid grid-cols-6 gap-6",children:[(null==eo?void 0:eo.cod_status)&&(0,l.jsxs)("div",{className:"col-span-6 sm:col-span-3",children:[(0,l.jsx)(form_InputPayment,{setShowCard:L,register:D,name:et("common:cashOnDelivery"),value:"Cash",Icon:u.Kau}),(0,l.jsx)(g.Z,{errorName:z.paymentMethod})]}),(null==eo?void 0:eo.stripe_status)&&(0,l.jsxs)("div",{className:"col-span-6 sm:col-span-3",children:[(0,l.jsx)(form_InputPayment,{setShowCard:L,register:D,name:et("common:creditCard"),value:"Card",Icon:p.hoO}),(0,l.jsx)(g.Z,{errorName:z.paymentMethod})]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-6 gap-4 lg:gap-6 mt-10",children:[(0,l.jsx)("div",{className:"col-span-6 sm:col-span-3",children:(0,l.jsxs)(m(),{href:"/",className:"bg-indigo-50 border border-indigo-100 rounded py-3 text-center text-sm font-medium text-gray-700 hover:text-gray-800 hover:border-gray-300 transition-all flex justify-center font-serif w-full",children:[(0,l.jsx)("span",{className:"text-xl mr-2",children:(0,l.jsx)(u.diL,{})}),el(null==es?void 0:null===(w=es.checkout)||void 0===w?void 0:w.continue_button)]})}),(0,l.jsx)("div",{className:"col-span-6 sm:col-span-3",children:(0,l.jsx)("button",{type:"submit",disabled:X||!J||ee,className:"bg-[#e0015e] hover:bg-[#20b7dc] border border-[#e0015e] transition-all rounded py-3 text-center text-sm font-serif font-medium text-white flex justify-center w-full",children:ee?(0,l.jsxs)("span",{className:"flex justify-center text-center",children:[" ",(0,l.jsx)("img",{src:"/loader/spinner.gif",alt:"Loading",width:20,height:10})," ",(0,l.jsx)("span",{className:"ml-2",children:et("common:processing")})]}):(0,l.jsxs)("span",{className:"flex justify-center text-center",children:[el(null==es?void 0:null===(Z=es.checkout)||void 0===Z?void 0:Z.confirm_button),(0,l.jsxs)("span",{className:"text-xl ml-2",children:[" ",(0,l.jsx)(u.qvS,{})]})]})})})]})]})})}),(0,l.jsx)("div",{className:"md:w-full lg:w-2/5 lg:ml-10 xl:ml-14 md:ml-6 flex flex-col h-full md:sticky lg:sticky top-28 md:order-2 lg:order-2",children:(0,l.jsxs)("div",{className:"border p-5 lg:px-8 lg:py-8 rounded-lg bg-white order-1 sm:order-2",children:[(0,l.jsx)("h2",{className:"font-semibold font-serif text-lg pb-4",children:el(null==es?void 0:null===(k=es.checkout)||void 0===k?void 0:k.order_summary)}),(0,l.jsxs)("div",{className:"overflow-y-scroll flex-grow scrollbar-hide w-full max-h-64 bg-gray-50 block",children:[K.map(e=>(0,l.jsx)(y.Z,{item:e,currency:Q},e.id)),X&&(0,l.jsxs)("div",{className:"text-center py-10",children:[(0,l.jsx)("span",{className:"flex justify-center my-auto text-gray-500 font-semibold text-4xl",children:(0,l.jsx)(u.c77,{})}),(0,l.jsx)("h2",{className:"font-medium font-serif text-sm pt-2 text-gray-600",children:"No Item Added Yet!"})]})]}),(0,l.jsx)("div",{className:"flex items-center mt-4 py-4 lg:py-4 text-sm w-full font-semibold text-heading last:border-b-0 last:text-base last:pb-0",children:(0,l.jsx)("form",{className:"w-full",children:R.couponCode?(0,l.jsxs)("span",{className:"bg-emerald-50 px-4 py-3 leading-tight w-full rounded-md flex justify-between",children:[" ",(0,l.jsx)("p",{className:"text-emerald-600",children:"Coupon Applied "})," ",(0,l.jsx)("span",{className:"text-red-500 text-right",children:R.couponCode})]}):(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row items-start justify-end",children:[(0,l.jsx)("input",{ref:U,type:"text",placeholder:et("common:couponCode"),className:"form-input py-2 px-3 md:px-4 w-full appearance-none transition ease-in-out border text-input text-sm rounded-md h-12 duration-200 bg-white border-gray-200 focus:ring-0 focus:outline-none focus:border-emerald-500 placeholder-gray-500 placeholder-opacity-75"}),(0,l.jsx)("button",{onClick:Y,className:"md:text-sm leading-4 inline-flex items-center cursor-pointer transition ease-in-out duration-300 font-semibold text-center justify-center border border-gray-200 rounded-md placeholder-white focus-visible:outline-none focus:outline-none px-5 md:px-6 lg:px-8 py-3 md:py-3.5 lg:py-3 mt-3 sm:mt-0 sm:ml-3 md:mt-0 md:ml-3 lg:mt-0 lg:ml-3 hover:text-white hover:bg-emerald-500 h-12 text-sm lg:text-base w-full sm:w-auto",children:el(null==es?void 0:null===(S=es.checkout)||void 0===S?void 0:S.apply_button)})]})})}),(0,l.jsxs)("div",{className:"flex items-center py-2 text-sm w-full font-semibold text-gray-500 last:border-b-0 last:text-base last:pb-0",children:[el(null==es?void 0:null===(I=es.checkout)||void 0===I?void 0:I.sub_total),(0,l.jsxs)("span",{className:"ml-auto flex-shrink-0 text-gray-800 font-bold",children:[Q,null==$?void 0:$.toFixed(2)]})]}),(0,l.jsxs)("div",{className:"flex items-center py-2 text-sm w-full font-semibold text-gray-500 last:border-b-0 last:text-base last:pb-0",children:[el(null==es?void 0:null===(O=es.checkout)||void 0===O?void 0:O.shipping_cost),(0,l.jsxs)("span",{className:"ml-auto flex-shrink-0 text-gray-800 font-bold",children:[Q,G.toFixed(2)]})]}),(0,l.jsxs)("div",{className:"flex items-center py-2 text-sm w-full font-semibold text-gray-500 last:border-b-0 last:text-base last:pb-0",children:[el(null==es?void 0:null===(P=es.checkout)||void 0===P?void 0:P.discount),(0,l.jsxs)("span",{className:"ml-auto flex-shrink-0 font-bold text-orange-400",children:[Q,V.toFixed(2)]})]}),(0,l.jsx)("div",{className:"border-t mt-4",children:(0,l.jsxs)("div",{className:"flex items-center font-bold font-serif justify-between pt-5 text-sm uppercase",children:[el(null==es?void 0:null===(E=es.checkout)||void 0===E?void 0:E.total_cost),(0,l.jsxs)("span",{className:"font-serif font-extrabold text-lg",children:[Q,parseFloat(W).toFixed(2)]})]})})]})})]})})})})},T=i()(()=>Promise.resolve(Checkout),{ssr:!1});var D=(0,a.Z)(T,{...o,isLoader:!0,skipInitialProps:!1,loadLocaleFrom:(e,t)=>s(242)("./".concat(e,"/").concat(t)).then(e=>e.default)})},4671:function(e,t,s){"use strict";var l=s(3049);t.Z={getAllCoupons:async()=>l.Z.get("/coupon"),getShowingCoupons:async()=>l.Z.get("/coupon/show")}},4302:function(e,t,s){"use strict";var l=s(3049);t.Z={addOrder:async(e,t)=>l.Z.post("/order/add",e,t),createPaymentIntent:async e=>l.Z.post("/order/create-payment-intent",e),getOrderCustomer:async e=>{let{page:t=1,limit:s=8}=e;return l.Z.get("/order?limit=".concat(s,"&page=").concat(t))},getOrderById:async(e,t)=>l.Z.get("/order/".concat(e),t)}}},function(e){e.O(0,[260,609,519,351,929,679,921,769,774,888,179],function(){return e(e.s=5248)}),_N_E=e.O()}]);